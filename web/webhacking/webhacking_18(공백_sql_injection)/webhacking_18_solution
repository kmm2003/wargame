sql injection 문제로 소스코드를 확인할수있는 문제이다.

소스코드를 먼저 확인해 보겠다.

no파라마터를 통해 입력값을 전달하며 
공백,/,(,),|,&,select,from,0x등을 필터링하여 hack으로 간주한다.

result로 반환되는 쿼리문은 id가 guest이면서 no값이 내가 입력한 no값인 레코드의 id를 
출력하는 쿼리문이다. 

result로 반환한 값이 admin이면 문제가 해결되면 주석을 통해 admin의 no가 2임을 알려주고있다.

쿼리문에 where id='guest'가 들어있기때문에 이 쿼리문을 그대로 사용해서는 절대로 admin id를
출력하지는 못할 것이다.

따라서 where부분을 수정하거나 union을 이용하여 아에 새로운 쿼리문을 select하는 방법이 있는데
지금의 경우에는 정규표현식을 통해 select와 from을 필터링하고 있기때문에 union을 이용하는
방법은 힘들 것 같고  where부분을 수정하는 느낌으로 문제를 해결해보아야겠다.

우선 where문에 id='guest' and no=$_GET[no]로 반환되는 레코드가 존재하지 않아야 됨으로
직접 입력을 하여 id가 guest일때의 no값을 구해보겠다.

예상대로 1이였다.

그렇다면 쿼리문을 이런식으로 짜볼수 있겠다.

2'or%09id='admin

이 쿼리문을 통해 id='guest' and no='2'or%09id='admin'이라는 쿼리값이 들어가게 될텐데
여기서 %09를 넣은이유는 위에서 정규표현식으로 " "와 같은 공백이 필터링되는데 이거를 우회하고자 
tab문자를 이스케이프 시퀀스로 바꾼값인 %09를 사용하였다.

위 입력쿼리문을 입력하면 id가 guest이면서 no가 2인 레코드는 없기때문에 반환이 안되고 id가 admin인 레코드의 id만 반환이 될 것이다. 한번 넣어보겠다.

엥....안된다.......왜지???

2'%09or%09id='admin을 쳤는데도 안된다....허허;;;;; 되야되는뎅...

혹시몰라서 2뒤에 '를 빼고 한번 해보았다.

2%09or%09id='admin'

클리어???????????

클리어 됐다...ㅋㅋㅋㅋ

근데 여기서 조금 의문이 드는 건 url 파라미터로 전송이되기때문에 전체가 문자열 취급이고
따라서 '입력값'의 형태로 쿼리문에 들어갈 것이라고 생각했는데 그게 잘못된 생각이였다는 것이다.

즉, where id='guest' no=2 or id='admin'의 형태로 쿼리문에 값이 들어간다는 것이고
이말인 즉슨 숫자만 전송되어 쿼리문에 가는 경우에는 자동으로 int형으로 반환하여 쿼리문에 들어간다는 것이라고 생각해볼 수 있겠다.

혹시몰라서 admin 양쪽에 ''를 빼고 전송해보았지만 실패되는 것으로 보아 확실히
숫자는 정수형으로 '' 이것이 필요없고 문자나 문자열은 ''가 필요하게끔 변환되어 쿼리문에
들어가나보다.

변환되어 들어간다고 생각한 이유는 url은 확실히 문자열이기 때문에 문자열로 전송되는 것이 맞으며
예전 7번 문제에서도 2 대신에 char(50)을 넣어 문자열을 보내는 식의 방법이 문제의 풀이방식에 있었던것으로 보아 문자열형태로 전송하되 php나 sql에서 숫자만 있는 경우는 int형으로 반환하는 것으로 생각된다.

앞으로 문제푸는데에 있어 아주 중요한 요소가 될 것 같다.

다시 생각해보니 위에 이유 때문이 아니라 그냥 애초에 create 될때 no 속성이 선언된 타입이 int여서 인듯?


