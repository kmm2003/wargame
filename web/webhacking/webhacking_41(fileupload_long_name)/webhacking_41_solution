이번 문제는 파일업로드 관련 문제로 파일을 업로드 할 수 있게 구성되어있다.

소스를 보니 업로드한 파일의 이름을 4번의 치환과정하며 거쳐서 $fn변수에 저장하며
파일의 임시파일이름을 $cp변수에 저장 후 
임시파일을 ./{$upload_dir}/{$fn} 경로의 파일에 카피하여 저장한다.

그 후 $fn파일에 flag값을 쓴다.

$upload_dir라는 디렉토리에 저장된 $fn이라는 파일의 내용을 읽어 flag값을 알아내야 하는 
문제이다.

즉, $upload_dir라는 디렉토리의 이름을 알아야 한다.

우선 업로드 하는 파일의 이름을 수정하여 인젝션 공격을 수행해야 되기 때문에 
버프스위트로 패킷을 잡아보자

test라는 텍스트파일을 전송 후

버프스위트를 이용해 패킷을 잡아보니 데이터 영역의 webkit영역을 통해
filename이라는 변수를 이용하여 업로드하는 파일의 이름이 전달되는 것을 확인 할 수 있다.

이 부분을 변조하여 엄청나게 긴 길이의 값으로 바꿔서 전송해보자

엄청나게 긴 값을 넣어보니 warning이 뜨면서 오류가 발생한다.
내용을 읽어보면 copy함수부분이 오류가 존재함을 알려주는데 파일의 이름이 너무 길어서 오류가 뜬것이며 여기서 copy함수안의 인자값이 노출되는데 
이때, 파일이름 뿐 아니라 우리가 필요한 디렉토리값까지 같이 노출이된다.
즉, 파일은 ./{$upload_dir}/{$fn} 에 저장된다고 했기 때문에 
우리가 필요한 $upload_dir 의 값을 알 수 있게 된다.

알아낸 경로로 접속해보자(알아낸 디렉토리에서 아까 올렸던 test파일에 접속하였다.)

flag값이 존재한다.

클리어!!
